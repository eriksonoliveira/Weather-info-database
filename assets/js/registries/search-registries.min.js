"use strict";var start,end,systems,draw,resultList;function searchRegistry(t,e){t.preventDefault();var a=new FormData;start=$(e).siblings(".form-group").find("#start").val(),end=$(e).siblings(".form-group").find("#end").val(),systems=[],draw=!0,resultList=$(e).parents(".search-page-container").find(".result-table");var s=$(e).siblings(".systempick").find(".systempick-box").find("input:checked");if($(s).each(function(){var t=$(this).attr("data-id");systems.push({key:t})}),0==systems.length&&(draw=!1),!end){end=dateFormated("dash","","BRZ")}a.append("dateStart",start),a.append("dateEnd",end),a.append("systems",JSON.stringify(systems)),a.append("page",1),$.ajax({type:"POST",url:baseUrl+"pesquisar/data",data:a,dataType:"json",beforeSend:function(){$(".loader-wrap").addClass("show")},contentType:!1,processData:!1,success:function(t){$(".loader-wrap").removeClass("show"),showResults(t),pageNumbers(t)}})}function showResults(t){if($("#myChart").remove(),$(".result-stats-wrap").hide(),$(resultList).empty(),0!=t[0].data.length){draw&&($(".chart").append("<canvas id='myChart' style='background-color: #20BE9E;'></canvas>").addClass("chart-dimensions"),$(".result-stats-wrap").show(),drawLineChart(t[0].chart));var e=renderTable(t);$(resultList).html(e)}else{$(resultList).html("<div class='result-empty'>Nenhum registro encontrado</div>")}}function pageNumbers(t){var e=$(".result-table-pagination ul"),a={totalPages:Math.ceil(t[0].num_pages),visiblePages:5,first:"Primeira",prev:"Anterior",next:"Próxima",last:"Última",onPageClick:function(t,e){getPage(e)}};e.twbsPagination("destroy"),e.twbsPagination($.extend({},a))}function renderTable(t){var r="";return r+="<div class='table-responsive-md'>",r+="<table class='table table-hover'>",r+="<tr>",r+="<th colspan='4'>Registros</th>",r+="</tr>",r+="<tr class='result-table-categories'>",r+="<td class='th-date'>Data</th>",r+="<td class='th-img'>Im. Satélite</th>",r+="<td class='th-info'>Descrição</th>",r+="<td class='th-action'></th>",r+="</tr>",$.each(t[0].data,function(t,e){var a=e.date.split("-"),s=a[2]+"-"+a[1]+"-"+a[0];r+="<tr>",r+="<td class='cell-center result-table-date'>"+s+"</td>",r+="<td>",r+=appendImg(e),r+="</td>",r+="<td>",e.info.met["06Z"].condicao_tempo.text?r+="<p class='mb-3'><strong>Condição:</strong> "+e.info.met["06Z"].condicao_tempo.text+"</p>":r+="<p class='mb-3'>Sem informações para este dia</p>",r+="<p class='ocorrencias'><strong>Ocorrências:</strong></p>",r+="<p>"+appendPhenom(e.info.phenom)+"</p>",r+="</td>",r+="<td class='cell-center'>",r+="<a href='"+baseUrl+"registros/ver/"+e.date+"' target='_blank'>",r+="<button class='mui-btn view-registry'>Visualizar</button>",r+="</a>",r+="</td>",r+="</tr>"}),r+="</table>",r+="</div>"}function appendImg(t){var e="";return t.info.img["06Z"].im_satelite.fileName?e+="<a href='javascript:;' class='img-clickable'><img src='"+baseUrl+"assets/images/im_satelite/"+t.info.img["06Z"].im_satelite.fileName+"' class='result-table-img'/></a>":e+="<img src='"+baseUrl+"assets/images/default-thumbnail.jpg' class='result-table-img'/>"}function appendPhenom(t){var e=[],a=void 0;for(var s in t)for(var r in t[s]){if(!(a=t[s][r]))return"Sem registro";e.push(a.syst)}return e.join(", ")}function drawLineChart(t){var a=[],s=[],r=0;t.forEach(function(t,e){r+=Number(t.count),a.push(t.month),s.push(t.count)});var e={labels:a,datasets:[{label:"Ocorrências",backgroundColor:"rgba(146,224,208, 0.7)",data:s}]},n=document.getElementById("myChart").getContext("2d");new Chart(n,{type:"bar",data:e,options:{legend:{display:!1},title:{display:!0,text:"NÚMERO DE DIAS (por mês)",fontColor:"#EEE"},layout:{padding:{top:10,bottom:10}},responsive:!0,maintainAspectRatio:!0,scales:{yAxes:[{ticks:{beginAtZero:!0,stepSize:1,fontColor:"#EEE"},gridLines:{color:"#BBB",zeroLineColor:"#BBB"}}],xAxes:[{offset:!0,gridLines:{offsetGridLines:!1,color:"#BBB"},type:"time",time:{unit:"month",round:"month",displayFormats:{month:"MMM YYYY"}},ticks:{fontColor:"#EEE",autoSkip:!1}}]}}});showSum(r)}function showSum(t){if(0<t){var e="";e+="<div>",e+="</div>",e+="<div>",e+="<div><small><strong>TOTAL</strong></small></div>",e+="<strong>"+t+"</strong>",e+=1<t?"<small>DIAS</small>":"<small>DIA</small>",e+="</div>",$(".result-sum div").html(e)}}function getPage(t){var e=new FormData;e.append("dateStart",start),e.append("dateEnd",end),e.append("systems",JSON.stringify(systems)),e.append("page",t),$.ajax({type:"POST",url:baseUrl+"pesquisar/data",data:e,dataType:"json",beforeSend:function(){$(".loader-wrap").addClass("show")},contentType:!1,processData:!1,success:function(t){$(".loader-wrap").removeClass("show");var e=renderTable(t);$(resultList).html(e)}})}$(document).ready(function(){$(".search-btn").on("click",function(t){searchRegistry(t,$(this))}),$(".show-sidebar").on("click",function(){$(".search-sidebar").addClass("active")}),$(".close-sidebar").on("click",function(){$(".search-sidebar").removeClass("active")})});
