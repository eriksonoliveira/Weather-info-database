"use strict";function previewImages(e,t){var a=$(t).parents(".form-img").next(".img-wrap"),n=$(a).find(".img-overlay"),i=$(t).parent(),s=$(t).parents(".form-img"),r="",o=$(a).prev("form").find(".img-cancel"),d=$(a).prev("form").find(".send-img");r+="<a href='javascript:;'>",r+="<img src='"+URL.createObjectURL(e.target.files[0])+"' class='img-width img-fluid'/>",r+="</a>",$(a).append(r),$(n).css("display","none"),$(s).css("z-index","2"),$([o,d]).each(function(){$(this).show()}),$(i).hide(),$(o).on("click",function(){$(a).find("img").remove(),$([o,d]).each(function(){$(this).hide()}),$(i).show()})}function sendImage(e,t,a){e.preventDefault();var n=$(t).parents(".form-img"),i=$(n).find("input[type=file]")[0].files;if(0<i.length){var s=$(t),r=$(t).siblings(".img-cancel"),o=$(t).parents(".form-img").siblings(".img-wrap"),d=$(t).parents(".form-img"),c=$(o).find(".img-overlay"),p=$(o).find("img"),m=$(o).find("a"),u=$(n).find("input[type=file]").attr("data-hora"),f=$(n).find("input[type=file]").attr("data-categoria"),l=$(n).nextAll(".sucesso-msg").first(),g=new FormData;g.append("date",a),g.append("horario",u),g.append("categoria",f),g.append("imagem",i[0]),new AjaxRequest(g).call("ajax",function(e){(e.success="yes")&&($(l).html("Imagem enviada com sucesso!"),setTimeout(function(){$(l).fadeOut()},3e3),$(p).attr("id","img-"+e.imgId).attr("class","img-width img-fluid"),$(m).attr("class","img-clickable"),$(c).css("display","flex"),$([s,r]).each(function(){$(this).hide()}),$(d).css("z-index","auto"))})}}function sendText(e,t,a){e.preventDefault();var n=new FormData,i=new KeyElements(t);$(i.textArea).each(function(){var e=$(this).attr("data-categoria"),t=$(this).val();$(this).parents(".reg-form").siblings(".sucesso-msg");0<$.trim(t).length&&(n.append("date",a),n.append("horario",i.horario),n.append("categoria",e),n.append("texto",t),n.append("id_nome",i.nome),n.append("cargo",i.cargo),$.ajax({type:"POST",url:baseUrl+"ajax",data:n,dataType:"json",contentType:!1,processData:!1,success:function(e){i.success="yes",$(i.buttons).html("<button class='btn btn-info edit-text'>Editar</button>"),$(i.textArea).each(function(){$(this).prop("disabled",!0)})}}))}),"yes"==i.success&&$(successMsg).html("Texto enviado com sucesso!")}function sendTag(e,t){var a=new FormData,n=$(e).attr("data-id");a.append("systemId",n),a.append("date",t),$.ajax({type:"POST",url:baseUrl+"ajax/sendTags",data:a,contentType:!1,processData:!1,success:function(){}})}function deleteImg(e){var t=new FormData,a=$(e).parent().siblings("a").find("img"),n=$(a).attr("id"),i=$(e).parents(".img-wrap").next(".sucesso-msg"),s=$(e).parents(".img-wrap").prev(".reg-form").find(".input-btn-wrap");t.append("imgID",n),$.ajax({type:"POST",url:baseUrl+"ajax",data:t,dataType:"json",contentType:!1,processData:!1,success:function(e){(e.success="yes")&&($(i).html("Imagem removida com sucesso!"),setTimeout(function(){$(i).fadeOut()},3e3),$(a).remove(),$(s).show(),$(".bg-box, .modal-box").fadeOut("fast"))}})}function deleteSystem(e,t){var a=$(e).attr("data-id"),n=new FormData,i={systemId:a,date:t};n.append("systemData",JSON.stringify(i)),new AjaxRequest(n).call("ajax/deleteSystem")}function getData(e){var t=new FormData;t.append("date",e),$.ajax({type:"POST",url:baseUrl+"ajax",data:t,dataType:"json",contentType:!1,processData:!1,success:function(e){var t=e.currDayReg.img,a=e.currDayReg.met,n=e.currDayReg.tec,i=e.currDayReg.info,s=e.currDayReg.phenom;receiveDayImages(t),receiveDayText(a,"meteoro"),receiveDayText(n,"tec"),receiveDayInfo(i),receiveDayPhenomena(s)}})}function receiveDayImages(e){for(var t in e){var a=t;for(var n in e[t]){var i=n;if(e[t][n].fileName){var s=baseUrl+"assets/images/"+i+"/"+e[t][n].fileName,r=e[t][n].id,o=".img-wrap[data-categoria="+i+"][data-hora="+a+"]",d=($(o).find(".img-del"),$(o).prev(".form-img")),c=$(d).find(".input-btn-wrap"),p="";p+="<a href='javascript:;' class='img-clickable'><img src='"+s+"' id='img-"+r+"' class='img-width img-fluid'/></a>",$(o).append(p),$(d).css("z-index","auto"),$(c).hide()}}}}function receiveDayText(e,t){for(var a in e){var n=a;for(var i in e[a]){var s=i,r=e[a][i].text,o=e[a][i].id;if(r){var d="textarea[data-categoria="+s+"][data-hora="+n+"]",c=$(d).parent(".bmd-form-group").siblings(".buttons");$(d).html(r).prop("disabled",!0),$("select[data-cargo="+t+"][data-hora="+n+"] option[value="+o+"]").prop("selected",!0),$(c).html("<button class='btn btn-info edit-text'>Editar</button>")}}}}function receiveDayInfo(e){var t=$("#info-gerais").find("textArea[data-categoria=info-gerais]"),a=e.text,n=$(t).parent(".bmd-form-group").siblings(".buttons");a&&(t.html(a).prop("disabled",!0),$(n).html("<button class='btn btn-info edit-text'>Editar</button>"))}function receiveDayPhenomena(e){for(var t in e)for(var a in e[t]){var n=e[t][a].id_sistema,i=(e[t][a].syst,$(".fenom").find("input[data-id="+n+"]"));$(i).siblings(".checkmark");$(i).prop("checked",!0)}}function editText(e,t){e.preventDefault();var a=$(t).parent();$(a).html("<button type='submit' class='btn btn-raised btn-primary update-text'>Atualizar</button><button class='btn update-cancel'>Cancelar</button>"),$(a).siblings(".bmd-form-group").find("textarea").prop("disabled",!1)}function updateText(e,a,n){e.preventDefault();var i=new FormData,s=new KeyElements(a);$(s.textArea).each(function(){var e=$(this).attr("data-categoria"),t=$(this).val();$(this).prevAll(".reg-form").nextAll(".sucesso-msg").first();0<$.trim(t).length&&(i.append("update-date",n),i.append("update-horario",s.horario),i.append("update-categoria",e),i.append("update-texto",t),i.append("update-id_nome",s.nome),i.append("update-cargo",s.cargo),$.ajax({type:"POST",url:baseUrl+"ajax",data:i,dataType:"json",contentType:!1,processData:!1,success:function(e){var t=$(a).parent();$(t).html("<button class='btn btn-primary edit-text'>Editar</button>"),$(s.textArea).each(function(){$(this).prop("disabled",!0)})}}))})}function cancelUpdate(e,t){e.preventDefault();var a=$(t).parent();$(a).html("<button class='btn btn-primary edit-text'>Editar</button>"),$(a).siblings(".bmd-form-group").find("textarea").prop("disabled",!0)}$(document).ready(function(){if(!1===date){date=dateFormated("dash")}$("input[type=file]").change(function(e){previewImages(e,$(this))}),$(".send-img").on("click",function(e){sendImage(e,$(this),date),console.log(date)}),$(document).on("click",".send-text",function(e){sendText(e,$(this),date)}),$(".fenom input[type=checkbox]").change(function(){this.checked&&sendTag($(this),date)})}),$(document).ready(function(){if(!1===date){date=dateFormated("dash")}$(".img-del").on("click",function(){var e=$(this);modal(e,2),$(document).on("click",".modal-del-confirm",function(){deleteImg(e)})}),$(".fenom input[type=checkbox]").change(function(){0==this.checked&&deleteSystem($(this),date)})}),$(document).ready(function(){if(!1===date){date=dateFormated("dash")}getData(date),$("input[name=calendar-3]").on("change",function(){var e=$(this).val().split("-"),t=dateFormated("dash",e),a=baseUrl+"registros/ver/"+t;window.location.assign(a)})}),$(document).ready(function(){if(!1===date){date=dateFormated("dash")}$(document).on("click",".edit-text",function(e){editText(e,$(this))}),$(document).on("click",".update-text",function(e){updateText(e,$(this),date)}),$(document).on("click",".update-cancel",function(e){cancelUpdate(e,$(this))})});
